<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="HandheldFriendly" content="True"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <title>Nyasoft</title>
  
    <link rel="alternative" href="/rss2.xml" title="Nyasoft" type="application/atom+xml">
  
  <meta name="description" content="Nyasoft is a blog about web and android development technology">
<meta property="og:type" content="website">
<meta property="og:title" content="Nyasoft">
<meta property="og:url" content="http://nya.io/index.html">
<meta property="og:site_name" content="Nyasoft">
<meta property="og:description" content="Nyasoft is a blog about web and android development technology">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nyasoft">
<meta name="twitter:description" content="Nyasoft is a blog about web and android development technology">
  <link rel="stylesheet" href="/css/2bb849c6.styles.css">
  <link rel="stylesheet" href="/fancybox/source/jquery.fancybox.css" type="text/css">
  
</head>
<body>
<nav class="navbar">
  <div class="container-full">
    <a class="brand" href="/">Nyasoft</a>

    <div class="collapse">
      <input id="drawer-toggle" type="checkbox" name="drawer-toggle"/>
      <label for="drawer-toggle" id="drawer-toggle-label">
        <i class="fa fa-navicon"></i>
        <span class="action-name">Nyasoft</span>
      </label>
      <label for="drawer-toggle" id="backdrop-button"></label>
      <ul id="drawer-menu" class="nav nav-menu stack">
        <li class="site-homepage">
          <a href="/">Nyasoft</a>
        </li>
        
        <li>
          <a href="/about">About</a>
        </li>
        
        <li>
          <a href="/archives">Archives</a>
        </li>
        
        <li>
          <a href="/projects">Projects</a>
        </li>
        
        <li>
          <a href="/links">Links</a>
        </li>
        
      </ul>
    </div>
    <div class="container hori-nav-menu">
      <ul class="nav nav-menu">
        
        <li>
          <a href="/about">About</a>
        </li>
        
        <li>
          <a href="/archives">Archives</a>
        </li>
        
        <li>
          <a href="/projects">Projects</a>
        </li>
        
        <li>
          <a href="/links">Links</a>
        </li>
        
      </ul>
    </div>
    <div class="corner-container">
      <ul class="nav nav-menu">
        
        <li>
          <a href="/rss2.xml" title="RSS Feed">
            <i class="fa fa-rss"></i>
          </a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <section class="article-list">

  <article class="article-container">
  <a href="/uncategorized/Angular-Prerender-in-5-minutes/" class="post-date mobile-meta">
  <time datetime="2017-04-24T09:33:24.000Z">4月 24 2017</time>
</a>
  <div class="article-content">
    <header class="article-header">
      
        

<h1>
  <a href="/uncategorized/Angular-Prerender-in-5-minutes/">Angular Prerender in 5 minutes</a>
</h1>


      
    </header>
    <div class="article-entry">
      
        <p>Angular has a prerender support once called <a href="https://github.com/angular/universeral" target="_blank" rel="external">Angular Universal</a> which recently merged into the official
@angular/platform-server package. It’s official guide for universal is still working in progress. It requires a lot of configuration if you have read
the document. Most important is you need to setup and AOT configuration and use @angular/compiler-cli to compile your source code.</p>
<p>But if you want to know how to use this feature in a briefly way without touching too much concept like express. Read this article. I’ll show you
an extreme concise example to setup a very basic prerender application.</p>
<p>Here we go.</p>
<h2 id="Step_1">Step 1</h2><p>Setup a basic angular project. In this example, we have only one component and module</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── package<span class="class">.json</span></span><br><span class="line">├── src</span><br><span class="line">│   ├── app</span><br><span class="line">│   │   ├── app<span class="class">.component</span><span class="class">.ts</span></span><br><span class="line">│   │   ├── app<span class="class">.module</span><span class="class">.ts</span></span><br><span class="line">│   │   └── app<span class="class">.server</span><span class="class">.ts</span></span><br><span class="line">│   ├── index<span class="class">.html</span></span><br><span class="line">│   ├── main<span class="class">.browser</span><span class="class">.aot</span><span class="class">.ts</span></span><br><span class="line">│   ├── main<span class="class">.browser</span><span class="class">.ts</span></span><br><span class="line">│   └── main<span class="class">.server</span><span class="class">.ts</span></span><br><span class="line">├── tsconfig<span class="class">.json</span></span><br><span class="line">├── tsconfig<span class="class">.aot</span><span class="class">.json</span></span><br></pre></td></tr></table></figure>
<p>app.component.ts is a very basic component</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="type">Component</span>&#125; <span class="keyword">from</span> '@angular/core';</span><br><span class="line"></span><br><span class="line">@<span class="type">Component</span>(&#123;</span><br><span class="line">    selector: 'app',</span><br><span class="line">    <span class="keyword">template</span>: '&lt;<span class="keyword">div</span>&gt;<span class="type">It</span> works&lt;/<span class="keyword">div</span>&gt;'</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> class <span class="type">App</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then I make an AppModule with BrowserModule imported. Call withServerTransition will make sure prerendered app can transit into browser module.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;NgModule&#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;App&#125; <span class="keyword">from</span> <span class="string">'./app.component'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;BrowserModule&#125; <span class="keyword">from</span> <span class="string">'@angular/platform-browser'</span>;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">    declarations: [App],</span><br><span class="line">    imports: [BrowserModule.withServerTransition(&#123;</span><br><span class="line">        appId: <span class="string">'iroha'</span></span><br><span class="line">    &#125;)],</span><br><span class="line">    bootstrap: [App]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Step_2">Step 2</h2><p>To make sure server can bootstrap this app, A server module is also needed. The important part in AppServerModule is that it imports a module called
 ServerModule from @angular/platform-server. This module has some server replacement for the browser provider in BrowserModule.</p>
<p>After having these files in hand. use ngc (Angular Compiler) to compile these files, but before continue, let’s dig into the tsconfig.aot.json file
to see something important for compiling with ngc.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">compilerOptions</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">module</span>": <span class="value"><span class="string">"es2015"</span></span>,</span><br><span class="line">    "<span class="attribute">target</span>": <span class="value"><span class="string">"es5"</span></span>,</span><br><span class="line">    "<span class="attribute">moduleResolution</span>": <span class="value"><span class="string">"node"</span></span>,</span><br><span class="line">    "<span class="attribute">emitDecoratorMetadata</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">experimentalDecorators</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">allowSyntheticDefaultImports</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">sourceMap</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">noEmit</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">noEmitHelpers</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">strictNullChecks</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">lib</span>": <span class="value">[</span><br><span class="line">      <span class="string">"es2015"</span>,</span><br><span class="line">      <span class="string">"dom"</span></span><br><span class="line">    ]</span>,</span><br><span class="line">    "<span class="attribute">typeRoots</span>": <span class="value">[</span><br><span class="line">      <span class="string">"node_modules/@types"</span></span><br><span class="line">    ]</span>,</span><br><span class="line">    "<span class="attribute">types</span>": <span class="value">[</span><br><span class="line">      <span class="string">"hammerjs"</span>,</span><br><span class="line">      <span class="string">"node"</span></span><br><span class="line">    ]</span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">exclude</span>": <span class="value">[</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">"dist"</span>,</span><br><span class="line">    <span class="string">"src/**/*.spec.ts"</span></span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">awesomeTypescriptLoaderOptions</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">forkChecker</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">useWebpackText</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">angularCompilerOptions</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">genDir</span>": <span class="value"><span class="string">"./compiled"</span></span>,</span><br><span class="line">    "<span class="attribute">skipMetadataEmit</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">compileOnSave</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">  "<span class="attribute">buildOnSave</span>": <span class="value"><span class="literal">false</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>To make AOT compiled code, you should use <code>es2015</code> as module resolution, this will be convenient for import ngfactory and treeshaking. also
their are a little options which related to angular compile. <code>angularCompilerOptions.genDir</code> will setup the output path for ngc, all your compiled
module will be output in that path. <code>angularCompilerOptions.skipMetadataEmit</code>  property prevents the compiler from generating metadata files with the compiled application.
 Metadata files are not necessary when targeting TypeScript files, so there is no reason to include them.</p>
<p>Then, use <code>$(npm bin)/ngc -p tsconfig.aot.json</code> to generate AOT files. You’ll get compiled directory in your project root. like this.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── compiled</span><br><span class="line">│   └── src</span><br><span class="line">│       └── app</span><br><span class="line">│           ├── app<span class="class">.component</span><span class="class">.ngfactory</span><span class="class">.ts</span></span><br><span class="line">│           ├── app<span class="class">.component</span><span class="class">.ngsummary</span><span class="class">.json</span></span><br><span class="line">│           ├── app<span class="class">.module</span><span class="class">.ngfactory</span><span class="class">.ts</span></span><br><span class="line">│           ├── app<span class="class">.module</span><span class="class">.ngsummary</span><span class="class">.json</span></span><br><span class="line">│           ├── app<span class="class">.server</span><span class="class">.ngfactory</span><span class="class">.ts</span></span><br><span class="line">│           └── app<span class="class">.server</span><span class="class">.ngsummary</span><span class="class">.json</span></span><br></pre></td></tr></table></figure>
<h2 id="Step_3">Step 3</h2><p>Make some entry files for JIT browser, AOT browser and server render.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/main<span class="class">.browser</span><span class="class">.ts</span>,</span><br><span class="line">src/main<span class="class">.browser</span><span class="class">.aot</span><span class="class">.ts</span>,</span><br><span class="line">src/main<span class="class">.server</span><span class="class">.ts</span></span><br></pre></td></tr></table></figure>
<p>They are almost the same. but will a little different.</p>
<p>src/main.browser.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'core-js/es7/reflect'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'zone.js/dist/zone'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'ts-helpers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;platformBrowserDynamic&#125; <span class="keyword">from</span> <span class="string">'@angular/platform-browser-dynamic'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;AppModule&#125; <span class="keyword">from</span> <span class="string">'./app/app.module'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">platformBrowserDynamic().bootstrapModule(AppModule);</span><br></pre></td></tr></table></figure>
<p>src/main.browser.aot.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'core-js/es7/reflect'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'zone.js/dist/zone'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'ts-helpers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;platformBrowser&#125; <span class="keyword">from</span> <span class="string">'@angular/platform-browser'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;AppModuleNgFactory&#125; <span class="keyword">from</span> <span class="string">'../compiled/src/app/app.module.ngfactory'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);</span><br></pre></td></tr></table></figure>
<p>You may have noticed, the only difference between main.browser.ts and main.browser.aot.ts is In JIT, it use the AppModule directly and bootstrap
that module using platformBrowserDynamic.bootstrapModule(), while in AOT, it use platformBrowser.bootstrapModuleFactory() to bootstrap an ngfactory
from compiled file.</p>
<p>that’s the different. AOT compiled component and in file bootstrap, it won’t load JIT compiler, this will make the final shipped code smaller.</p>
<p>finally, let’ look into the main.server.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'core-js/es7/reflect'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'zone.js/dist/zone-node'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'ts-helpers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;renderModuleFactory&#125; <span class="keyword">from</span> <span class="string">'@angular/platform-server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;AppServerModuleNgFactory&#125; <span class="keyword">from</span> <span class="string">'../compiled/src/app/app.server.ngfactory'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">'path'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> template = fs.readFileSync(path.join(__dirname, <span class="string">'./index.html'</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    renderModuleFactory(AppServerModuleNgFactory, &#123;</span><br><span class="line">        <span class="built_in">document</span>: template.toString(),</span><br><span class="line">        url: <span class="string">'/'</span></span><br><span class="line">    &#125;)</span><br><span class="line">        .then((doc: string) =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(doc);</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>This file looks different from the previous two. it import zone-node instead of zone, because zone-node can be run in nodejs, zone cannot.</p>
<p>Because what we need is a string of the final html page. a factory called renderModuleFactory from @angular/platform-server is used here to
bootstrap our AppServerModuleNgFactory which is imported from compiled code.</p>
<p>At last, you can run ts-node to get the string of rendered app.</p>
<p>Is that over. exactly. No, Prerender also involve a transition step when app has loaded into browser and your browser module has taken over all
the state from server prerendered page. But this is the mainly about webpack configuration, what you need is build a bundle and shipped with the
generated html document from renderModuleFactory. and use preboot.js to make the state transition.</p>
<p>By reading this sort article, you now setup a up a very basic project without touch any unnecessary configuration. but to make a useful application,
you still need to learn how to tame webpack and build a bundle for browser. I may write something about this in the future.</p>

      
    </div>
  </div>
  <div class="article-additional">
    <div class="social-buttons">
      <a data-url="http://nya.io/uncategorized/Angular-Prerender-in-5-minutes/" data-id="cj1vz885d001xeols73vtwuyf" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
      </a>
    </div>
    
<a href="http://nya.io/uncategorized/Angular-Prerender-in-5-minutes/#disqus_thread" class="comment-count mobile-meta">
  Comments
</a>

    
  <ul class="tag-list nav-menu mobile-meta">
    
      <li>
        <a href="/tags/Angular/">#Angular</a>
      </li>
    
      <li>
        <a href="/tags/Server-Side-Rendering/">#Server Side, Rendering</a>
      </li>
    
      <li>
        <a href="/tags/prerender/">#prerender</a>
      </li>
    
  </ul>

  </div>
  <div class="article-meta">
    <a href="/uncategorized/Angular-Prerender-in-5-minutes/" class="post-date">
  <time datetime="2017-04-24T09:33:24.000Z">4月 24 2017</time>
</a>
    
<a href="http://nya.io/uncategorized/Angular-Prerender-in-5-minutes/#disqus_thread" class="comment-count">
  Comments
</a>

    
  <ul class="tag-list">
    
      <li>
        <a href="/tags/Angular/">#Angular</a>
      </li>
    
      <li>
        <a href="/tags/Server-Side-Rendering/">#Server Side, Rendering</a>
      </li>
    
      <li>
        <a href="/tags/prerender/">#prerender</a>
      </li>
    
  </ul>

  </div>
</article>



  <article class="article-container">
  <a href="/uncategorized/make-a-list-view-in-angular/" class="post-date mobile-meta">
  <time datetime="2017-04-11T06:35:43.000Z">4月 11 2017</time>
</a>
  <div class="article-content">
    <header class="article-header">
      
        

<h1>
  <a href="/uncategorized/make-a-list-view-in-angular/">Make A List View In Angular</a>
</h1>


      
    </header>
    <div class="article-entry">
      
        <p>Recently, I’m working on an solution to show vast amount of card in a list and scroll smoothly on this list. Further more, the list should
show a timeline meter on the side to allow user navigate to any position quickly just drag or click the timeline. This feature pose a challenge
to develop a new kind of UI component which able to show any amount of card in screen without impact the performance.</p>
<p>A tradition way to show large amount of data in a list is so called <em>infinite list</em> or <em>lazy loading</em> . A list loads data at 20-30 items per page until user reaches
bottom of the list. then bumps the next page of data and appends to current list. This solution actually contributes to the initial loading
performance but did not too much to the overall scrolling performance. Using this solution, user cannot quickly scroll to the last position of data.
even worse, when you have loaded 2000-3000 items, your tab crashes.</p>
<h2 id="Find_Another_Approach-">Find Another Approach.</h2><p>The reason why <em>lazy loading</em> or traditional <em>infinite list</em> doesn’t work is obvious. As long as you continue added items into your list, those
DOM elements will exists until eats up all of your memory. So this solution is not fit for our requirements.</p>
<p>If you ever have some experience on Android or iOS development. You may find the solution which has developed for a long time. Yes, that’s
ListView (or RecyclerView, GridView) in Android and UITableView in iOS. They both use a similar idea which keep a limited amount of item on
 the fly and trash the view which is out of current viewport. To reduce the performance expense on create new views, they also recycle the
 trashed views and reuse them on demand. So this idea is what I choose for solving this problem.</p>
<h3 id="First,_How_does_this_solution_work?">First, How does this solution work?</h3><p>The core of this solution is only maintaining a limited number of views in the list and keep remove and added necessary views into list when user
scrolling the list. To make this possible we need to know the height of each view before performing a layout to place those views. In Android,
the framework using a measurement procedure, but at web, we don’t have that mechanism, the dimension of an DOM element is control by css along
with the element parent. So measurement on DOM is hard to do, we don’t want to discuss this topic at this article. We use a predefined height
for each row. By doing this, we simplify the calculation of layout.</p>
<p>Another requirement to make this solution possible is we need to know the total number of items of our list. This is usually not much hard to do.
To make things simple, we also make a little change, we have all data loaded once, so we don’t need to write load on demand.</p>
<p>Once we prepared data and container finish its layout, we will get <strong>container height</strong> , <strong>number of rows</strong>, <strong>row height</strong> . these information
 is pretty enough for our list view to render a initial state.</p>
<p><img src="/img/infinite-list-1.jpg" alt="Initial State"></p>
<p>As you can see, our initial state only contains very limited number of elements. This is what we expect, another information we got from
this picture is we have a scrollbar which indicates we have very long content to scroll. we use a straight forward method to calculate the total
height of scroll content by simply multiply row height and item count. Here is the main DOM structure to make this possible.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- infinite-list has a height of 100% viewport height this height will be used to determine how many views to render --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"infinite-list"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- infinite-list-holder has a height of all --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"infinite-list-holder"</span> <span class="attribute">style</span>=<span class="value">"height: 140000px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">list-item-example</span>&gt;</span><span class="tag">&lt;/<span class="title">list-item-example</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>infinite-list</code> is the container of visible views, it use a <code>overflow-y: auto</code> css to make the <code>infinite-list-holder</code> scrollable.
When this structure is established, browser will render a scrollbar for <code>infinite-list</code>.</p>
<p>When user scroll down or up, the <code>infinite-list-holder</code> will scroll and together with its view content. meanwhile we listen to the
scroll event to asynchronously calculate how far we have scrolled from initial position.</p>
<p>THE key part of the solution can keep a low memory usage is keep calculating every view position relative to viewport, add views which
 are about to visible in the viewport and remove views which is already out of viewport.</p>
<p><img src="/img/infinite-list-2.jpg" alt="When content scrolling, remove and added views"></p>
<p>This is really very intuitive solution. keep added and remove views as long as there are the right views in our viewport, user will feel
like our list is filled with all of the data items. OK, this is simple. But how do we know which view is out of viewport, which view is
about to add in viewport and how to place them in the correct position.</p>
<h3 id="Do_the_layout">Do the layout</h3><p>we already have some basic information about our container <code>infinite-list</code>, we know its width and height. we also get height of every row
 and total number of data. when we do layout at scrolling, we need one more information to know how much have we scrolled. This is not hard
 to obtain. In all browser, we can use <code>element.scrollTop</code> property to know the relative distance between top of the scrolling content and
  top of the wrapper content. (More detail, you can learn from <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop" target="_blank" rel="external">MDN</a>)</p>
<p>Calculate the index of top most view relative to our viewport, remove any views before that index.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstIndex = <span class="built_in">Math</span>.floor(scrollTop / rowHeight);</span><br></pre></td></tr></table></figure>
<p>Calculate the index of bottom most view relative to our viewport, remove any views after that index.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// we need this offset to complement the height of viewport. because a view may just cross the border of list-container</span></span><br><span class="line"><span class="keyword">let</span> firstViewOffset = scrollTop - firstIndex * rowHeight;</span><br><span class="line"><span class="comment">// containerHeight is equal to viewport height as we assumed</span></span><br><span class="line"><span class="keyword">let</span> lastIndex = <span class="built_in">Math</span>.ceil((containerHeight + firstViewOffset) / rowHeight) + firstIndex;</span><br></pre></td></tr></table></figure>
<p>Once we get the index range, we can remove view not inside this range and added views according this range. To added view at correct position,
we need calculate its top y coordinate relative the list-holder.
This calculation is more easy. We can calculate a view y position base on row height and data item index:</p>
<p>A view top y position relative to infinite-list-holder is <code>rowHeight * index</code></p>
<p>The method we use to place our views on <code>infinite-list-holder</code> is using css3 translate3d and let each view’s position property be absolute.
By using this method we get the hardware acceleration and not trigger any re-layout out side the <code>infinite-list-holder</code>. This is another
 important performance trick.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viewElement.style.transform = `translate3d(<span class="number">0</span>, $&#123;y&#125;px, <span class="number">0</span>)`;</span><br><span class="line">viewElement.style.webkitTransform = `translate3d(<span class="number">0</span>, $&#123;y&#125;px, <span class="number">0</span>)`;</span><br><span class="line">viewElement.style.width = `$&#123;containerWidth&#125;px`;</span><br><span class="line">viewElement.style.height = `$&#123;rowHeight&#125;px`;</span><br><span class="line">viewElement.style.position = <span class="string">'absolute'</span>;</span><br></pre></td></tr></table></figure>
<p>Once styles is applied. insert view into <code>infinite-list-holder</code> at proper position, browser will render the view for us.</p>
<p>This process will repeat whenever we need to do a layout operation. At the user aspect, the view will really scroll in the list.</p>
<h3 id="Optimization-">Optimization.</h3><p>So far so good, We have give a smooth scrolling experience to user using our real <strong>infinite-list</strong> .but currently we only create a very
simple example which using a simple structure for item view. What if we have a very complex view to render. we need to rapidly remove and
add DOM element to our list-holder, the view element may have many object to initialize. many listener to add. Creating new object especially
DOM element object is expensive. Those views in our list are very the same structure, the only different is there content. so we decide to
do some optimization to reuse the views.</p>
<p>To reuse view, we need modified our solution at two phase, remove and add phase. At remove phase, we don’t directly destroy that trashed view,
we detach that view and move it into a recycle bin. we can create a class called <code>RecycleBin</code> to manage those recycled views. At add phase, we
 first try to retrieve view from RecycleBin, if we find the same view with the same index we expect, we can directly reattach it back to list-holder,
 because its content is the same. But if we don’t have that type of view, we can also pop a view from scrap views, and replace its binding data
 with correct data at certain index. If you use a MVVM framework, the framework will do the rest things. only when we don’t have scraped views
 from <code>RecycleBin</code>, we create a new view with data of certain index.</p>
<p><img src="/img/infinite-list-3.jpg" alt="RecycleBin"></p>
<p>Our modified version reduce the dom create and destroy, also reduce the new memory allocation and GC operation (though this is really depend
on JS engine). A drawback of this modification is we increase a little more memory usage. But if you can write some simple strategy to control
the total number of scrap views. No need to worry about run out of memory.</p>
<p>So far we have briefly explained how our solution work. But we haven’t explained how to implement in Angular.</p>
<h2 id="The_Angular_Implementation">The Angular Implementation</h2><p><em>we only cover the Angular 4 and above, if you want to find an AngularJS (1.x) implementation. You can read the code from <a href="https://github.com/ngFancy/ng-gridview" target="_blank" rel="external">this repository</a> to see how to
implement this approach in Angular 1.5, although this is grid view which is a little complicated.</em></p>
<p>In Angular, things are not much different. We still use the theory we have explained before plus a little angular feature.</p>
<p>In Angular, there are component and directive ( include structural directive ) which can manipulate DOM as we need. Recall our feature requirement,
Our list, in fact, has repeat structure which presents data in same form repeatedly. The idea flash in your mind first must be ngFor directive which
 is a structural directive can clone its content repeatedly. The difference between ngFor and our directive is ngFor render all DOM in the collection
 we don’t. So we use a similar directive called <code>infiniteFor</code> which has a very same usage.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">any</span> *<span class="attribute">infiniteFor</span>=<span class="value">"let row of collection"</span>&gt;</span></span><br><span class="line">    &#123;&#123;row&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="title">any</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>By using these semantic we borrowed from ngFor, we can create a local variable binding to its template from the iterable collection
In Angular we don’t have the concept <code>scope</code> but it is a very similar concept which using an object to store your local variable and bind to the template.
We won’t use too much words to describe how ngFor implement. if you don’t understand and have interest in this, you can read official document:
 <a href="https://angular.io/docs/ts/latest/guide/structural-directives.html#!#ngFor" target="_blank" rel="external">Structural Directive</a> and <a href="https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html" target="_blank" rel="external">ngFor API Guide</a></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">@Directive(&#123;</span><br><span class="line">    selector: <span class="string">'[infiniteFor][infiniteForOf]'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> InfiniteForOf&lt;T&gt; <span class="keyword">implements</span> OnChanges, DoCheck &#123;</span><br><span class="line">    <span class="keyword">private</span> _differ: IterableDiffer&lt;T&gt;;</span><br><span class="line">    <span class="keyword">private</span> _trackByFn: TrackByFunction&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is a major difference from ngFor directive, we actually need store the whole collection to a data structure (we use array)</span></span><br><span class="line">    <span class="keyword">private</span> _collection: <span class="built_in">any</span>[];</span><br><span class="line"></span><br><span class="line">    @Input() infiniteForOf: NgIterable&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    @Input()</span><br><span class="line">    <span class="keyword">set</span> infiniteForTrackBy(fn: TrackByFunction&lt;T&gt;) &#123;</span><br><span class="line">        <span class="keyword">this</span>._trackByFn = fn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> infiniteForTrackBy(): TrackByFunction&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._trackByFn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Input()</span><br><span class="line">    <span class="keyword">set</span> infiniteForTemplate(value: TemplateRef&lt;InfiniteRow&gt;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            <span class="keyword">this</span>._template = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="constructor"><span class="keyword">constructor</span>(private _infiniteList: InfiniteList,</span><br><span class="line">                private _differs: IterableDiffers,</span><br><span class="line">                private _template: TemplateRef&lt;InfiniteRow&gt;,</span><br><span class="line">                private _viewContainerRef: ViewContainerRef) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnChanges(changes: SimpleChanges): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'infiniteForOf'</span> <span class="keyword">in</span> changes) &#123;</span><br><span class="line">            <span class="comment">// React on infiniteForOf only once all inputs have been initialized</span></span><br><span class="line">            <span class="keyword">const</span> value = changes[<span class="string">'infiniteForOf'</span>].currentValue;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>._differ &amp;&amp; value) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>._differ = <span class="keyword">this</span>._differs.find(value).create(<span class="keyword">this</span>._trackByFn);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(`Cannot find a differ supporting object <span class="string">'$&#123;value&#125;'</span> of <span class="keyword">type</span> <span class="string">'$&#123;getTypeNameForDebugging(value)&#125;'</span>. NgFor only supports binding to Iterables such as Arrays.`);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngDoCheck(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._differ) &#123;</span><br><span class="line">            <span class="keyword">const</span> changes = <span class="keyword">this</span>._differ.diff(<span class="keyword">this</span>.infiniteForOf);</span><br><span class="line">            <span class="keyword">if</span> (changes) &#123;</span><br><span class="line">                <span class="keyword">this</span>.applyChanges(changes);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> applyChanges(changes: IterableChanges&lt;T&gt;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>._collection) &#123;</span><br><span class="line">            <span class="keyword">this</span>._collection = [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> isMeasurementRequired = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        changes.forEachOperation((item: IterableChangeRecord&lt;<span class="built_in">any</span>&gt;, adjustedPreviousIndex: <span class="built_in">number</span>, currentIndex: <span class="built_in">number</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.previousIndex == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// new item</span></span><br><span class="line">                isMeasurementRequired = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">this</span>._collection.splice(currentIndex, <span class="number">0</span>, item.item);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentIndex == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// remove item</span></span><br><span class="line">                isMeasurementRequired = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">this</span>._collection.splice(adjustedPreviousIndex, <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// move item</span></span><br><span class="line">                <span class="keyword">this</span>._collection.splice(currentIndex, <span class="number">0</span>, <span class="keyword">this</span>._collection.splice(adjustedPreviousIndex, <span class="number">1</span>)[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        changes.forEachIdentityChange((record: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>._collection[record.currentIndex] = record.item;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isMeasurementRequired) &#123;</span><br><span class="line">            <span class="keyword">this</span>.requestMeasure();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Instead of directly react on data changes, we need to store the whole data set into a collection because we may use it later,
But IterableDiffer is still a useful tool to manipulate our data collection without need to learn the actual data structure of source data.
when any changes of data happen, we mark a <code>isMeasurementRequired</code> to determine whether we need to recalculate the list-holder height.
This is needed when we change the size of collection. Whenever a change happen, a layout is requested.</p>
<p>Consider when we should do the layout. By learn the feature of our component, we can find three timing to do layout:</p>
<ul>
<li>After a measurement. (data set size changes, container dimension changes)</li>
<li>scroll event happens.</li>
<li>data changes</li>
</ul>
<p>The actual layout is the core process. we will break it into several parts.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> layout() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._isInLayout || !<span class="keyword">this</span>._collection || <span class="keyword">this</span>._collection.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>._isInLayout = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123;width, height&#125; = <span class="keyword">this</span>._infiniteList.measure();</span><br><span class="line">    <span class="keyword">this</span>._containerWidth = width;</span><br><span class="line">    <span class="keyword">this</span>._containerHeight = height;</span><br><span class="line">    <span class="keyword">this</span>.findPositionInRange();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>._viewContainerRef.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> child = <span class="xml"><span class="tag">&lt;<span class="title">EmbeddedViewRef</span>&lt;<span class="attribute">InfiniteRow</span>&gt;</span>&gt; this._viewContainerRef.get(i);</span><br><span class="line">        this._viewContainerRef.detach(i);</span><br><span class="line">        this._recycler.recycleView(child.context.index, child);</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line">    this.insertViews();</span><br><span class="line">    this._recycler.pruneScrapViews();</span><br><span class="line">    this._isInLayout = false;</span><br><span class="line">    this._invalidate = false;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>we first check the prerequisites, we should not do layout when:</p>
<ul>
<li>A layout is performing.</li>
<li>Collection is empty.</li>
</ul>
<p>Then update containerHeight because we need this in <code>findPositionInRange</code>,
After we do findPositionInRange( which is actually calculate the first and last index need to be in list-holder). we detach our existed views
in <code>list-holder</code>. and re insert needed views back into it. after all job is done, we also prune the recycle bin to make sure it will not bloat too big.</p>
<p>How we implement findPositionInRange has been explained in the previous section. the start index and end index is exactly follow those formula to calculate.
So the next important thing is adding views back to list-holder. the <code>getView</code> method first try to get views from recycle bin, if not find, create a new EmbeddedView
 with <code>InfiniteRow</code> object, this object is a data structure provide the data and some information like index, count. it has important property <code>$implicit</code> which is used
 by angular core to binding our data to view.</p>
<p>Once we get the view, <code>dispatchLayout</code> method will do the rest job to place views (applyStyle and insert).</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> insertViews() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="keyword">this</span>._firstItemPosition; i &lt;= <span class="keyword">this</span>._lastItemPosition; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="keyword">this</span>.getView(i);</span><br><span class="line">        <span class="keyword">this</span>.dispatchLayout(i, view, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> getView(position: <span class="built_in">number</span>): ViewRef &#123;</span><br><span class="line">    <span class="keyword">let</span> view = <span class="keyword">this</span>._recycler.getView(position);</span><br><span class="line">    <span class="keyword">let</span> item = <span class="keyword">this</span>._collection[position];</span><br><span class="line">    <span class="keyword">let</span> count = <span class="keyword">this</span>._collection.length;</span><br><span class="line">    <span class="keyword">if</span> (!view) &#123;</span><br><span class="line">        view = <span class="keyword">this</span>._template.createEmbeddedView(<span class="keyword">new</span> InfiniteRow(item, position, count));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        (view as EmbeddedViewRef&lt;InfiniteRow&gt;).context.$implicit = item;</span><br><span class="line">        (view as EmbeddedViewRef&lt;InfiniteRow&gt;).context.index = position;</span><br><span class="line">        (view as EmbeddedViewRef&lt;InfiniteRow&gt;).context.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> applyStyles(viewElement: HTMLElement, y: <span class="built_in">number</span>) &#123;</span><br><span class="line">    viewElement.style.transform = `translate3d(<span class="number">0</span>, $&#123;y&#125;px, <span class="number">0</span>)`;</span><br><span class="line">    viewElement.style.webkitTransform = `translate3d(<span class="number">0</span>, $&#123;y&#125;px, <span class="number">0</span>)`;</span><br><span class="line">    viewElement.style.width = `$&#123;<span class="keyword">this</span>._containerWidth&#125;px`;</span><br><span class="line">    viewElement.style.height = `$&#123;<span class="keyword">this</span>._infiniteList.rowHeight&#125;px`;</span><br><span class="line">    viewElement.style.position = <span class="string">'absolute'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> dispatchLayout(position: <span class="built_in">number</span>, view: ViewRef, addBefore: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> startPosY = position * <span class="keyword">this</span>._infiniteList.rowHeight;</span><br><span class="line">    <span class="keyword">this</span>.applyStyles((view as EmbeddedViewRef&lt;InfiniteRow&gt;).rootNodes[<span class="number">0</span>], startPosY);</span><br><span class="line">    <span class="keyword">if</span> (addBefore) &#123;</span><br><span class="line">        <span class="keyword">this</span>._viewContainerRef.insert(view, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._viewContainerRef.insert(view);</span><br><span class="line">    &#125;</span><br><span class="line">    view.reattach();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We have nearly all done. But because we separate the component into two pieces. we haven’t implement the container component <code>InfiniteList</code>.
It is responsible for listen to scroll event, resize event and set the <code>height</code> to list-holder, it has a simple dom structure:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- infinite-list.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"infinite-list"</span> #<span class="attribute">listContainer</span></span><br><span class="line">     [<span class="attribute">ngClass</span>]=<span class="value">"scrollbarStyle"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"infinite-list-holder"</span> [<span class="attribute">style.height</span>]=<span class="value">"holderHeightInPx"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ng-content</span>&gt;</span><span class="tag">&lt;/<span class="title">ng-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>By using <code>ng-content</code> we can put all element generated by <code>InfiniteForOf</code> directive. The important thing behind the html is a css definition.
We must make infinite-list <code>overflow-y: auto</code> and give it a limit height (if you container element have a height, you can use 100%)</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.infinite-list</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">contain</span>: layout;          <span class="comment">// this is performance trick, you can lookup this css property in MDN</span></span><br><span class="line">  <span class="attribute">-webkit-overflow-scrolling</span>: touch; <span class="comment">// make a touch scroll has resilient.</span></span><br><span class="line">  <span class="class">.infinite-list-holder</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;     <span class="comment">// relative is also a very important property. because of all its children will be position: absolute;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the InfiniteList class we heavily use the Observable from RxJS, if you are not familiar rxjs, you can find some material from the internet.
 There some important notice when implement this component.</p>
<ul>
<li>Do all DOM event binding in <code>AfterViewInit</code> lifecycle hook. and besides, you should use setTimeout() to trigger a immediate measurement. Because
this operation will change _containerWidth and _containerHeight in one tick which will cause an error in zone.js. so we need to schedule it to next tick.</li>
<li>scrollPosition subject is a BehaviorSubject, it has a convenience that a initial value will be emitted without need the scroll event. This is helpful to
initialize the layout of <code>InfiniteForOf</code>.</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">    selector: <span class="string">'infinite-list'</span>,</span><br><span class="line">    templateUrl: <span class="string">'infinite-list.html'</span>,</span><br><span class="line">    styleUrls: [<span class="string">'infinite-list.less'</span>]</span><br><span class="line">&#125;)</span><br><span class="line">export class InfiniteList implements AfterViewInit, OnDestroy &#123;</span><br><span class="line">    <span class="keyword">private</span> _holderHeight: number;</span><br><span class="line">    <span class="keyword">private</span> _containerWidth: number;</span><br><span class="line">    <span class="keyword">private</span> _containerHeight: number;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> _subscription: Subscription = <span class="keyword">new</span> Subscription();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> _scrollPosition: BehaviorSubject&lt;number&gt; = <span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> _sizeChange: BehaviorSubject&lt;number[]&gt; = <span class="keyword">new</span> BehaviorSubject([<span class="number">0</span>, <span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    @ViewChild(<span class="string">'listContainer'</span>) listContainer: ElementRef;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> holderHeight(<span class="variable">height</span>: number) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">height</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>._holderHeight = <span class="variable">height</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">get</span> holderHeight(): number &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._holderHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">get</span> holderHeightInPx(): string &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.holderHeight) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.holderHeight + <span class="string">'px'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'100%'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * current scroll position.</span><br><span class="line">     * @type &#123;number&#125;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">get</span> scrollPosition(): Observable&lt;number&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._scrollPosition.asObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * list container width and height.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">get</span> sizeChange(): Observable&lt;number[]&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._sizeChange.asObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Input() rowHeight: number;</span><br><span class="line"></span><br><span class="line">    ngAfterViewInit(): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (window) &#123;</span><br><span class="line">            <span class="keyword">this</span>._subscription.<span class="built_in">add</span>(Observable.fromEvent(window, <span class="string">'resize'</span>)</span><br><span class="line">                .subscribe(() =&gt; &#123;</span><br><span class="line">                    let &#123;<span class="variable">width</span>, <span class="variable">height</span>&#125; = <span class="keyword">this</span>.measure();</span><br><span class="line">                    <span class="keyword">this</span>._sizeChange.next([<span class="variable">width</span>, <span class="variable">height</span>]);</span><br><span class="line">                &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>._subscription.<span class="built_in">add</span>(Observable.fromEvent(<span class="keyword">this</span>.listContainer.nativeElement, <span class="string">'scroll'</span>)</span><br><span class="line">            .<span class="built_in">map</span>(() =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.listContainer.nativeElement.scrollTop;</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribe((scrollY: number) =&gt; &#123;</span><br><span class="line">                <span class="keyword">this</span>._scrollPosition.next(scrollY);</span><br><span class="line">            &#125;));</span><br><span class="line"></span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            let &#123;<span class="variable">width</span>, <span class="variable">height</span>&#125; = <span class="keyword">this</span>.measure();</span><br><span class="line">            <span class="keyword">this</span>._sizeChange.next([<span class="variable">width</span>, <span class="variable">height</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnDestroy(): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._subscription.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    measure():&#123;<span class="variable">width</span>: number, <span class="variable">height</span>: number&#125; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.listContainer &amp;&amp; <span class="keyword">this</span>.listContainer.nativeElement) &#123;</span><br><span class="line">            let <span class="built_in">rect</span> = <span class="keyword">this</span>.listContainer.nativeElement.getBoundingClientRect();</span><br><span class="line">            <span class="keyword">this</span>._containerWidth = <span class="built_in">rect</span>.<span class="variable">width</span> - <span class="keyword">this</span>.scrollbarWidth;</span><br><span class="line">            <span class="keyword">this</span>._containerHeight = <span class="built_in">rect</span>.<span class="variable">height</span>;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="variable">width</span>: <span class="keyword">this</span>._containerWidth, <span class="variable">height</span>: <span class="keyword">this</span>._containerHeight&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="variable">width</span>: <span class="number">0</span>, <span class="variable">height</span>: <span class="number">0</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>By now, we have all done. let’s use our component and directive together to make a list with infinite smooth scroll.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"demo-container"</span> *<span class="attribute">ngIf</span>=<span class="value">"collection"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">infinite-list</span> [<span class="attribute">rowHeight</span>]=<span class="value">"140"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">list-item-example</span> *<span class="attribute">infiniteFor</span>=<span class="value">"let row of collection; let i = index"</span> [<span class="attribute">item</span>]=<span class="value">"row"</span> [<span class="attribute">index</span>]=<span class="value">"i"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="title">list-item-example</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">infinite-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>In this case, we give the view height 140 to InfiniteList component and pass row local variable to ListItemExample component, the actual list item will
be rendered by <code>ListItemExample</code> component.</p>
<p>The demo can be found at <a href="https://github.com/lordfriend/Deneb-UI/tree/master/demo-app/app/infinite-list" target="_blank" rel="external">GitHub</a>.</p>
<p>The real component has some additional feature which can tell the list item component current scroll state. This will be helpful to make some decision
 when user is performing a fast scroll and avoid unnecessary resource loading.</p>

      
    </div>
  </div>
  <div class="article-additional">
    <div class="social-buttons">
      <a data-url="http://nya.io/uncategorized/make-a-list-view-in-angular/" data-id="cj1vz884d000oeols57pgunf4" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
      </a>
    </div>
    
<a href="http://nya.io/uncategorized/make-a-list-view-in-angular/#disqus_thread" class="comment-count mobile-meta">
  Comments
</a>

    
  <ul class="tag-list nav-menu mobile-meta">
    
      <li>
        <a href="/tags/Angular/">#Angular</a>
      </li>
    
      <li>
        <a href="/tags/InfiniteList/">#InfiniteList</a>
      </li>
    
      <li>
        <a href="/tags/ListView/">#ListView</a>
      </li>
    
      <li>
        <a href="/tags/Performance/">#Performance</a>
      </li>
    
  </ul>

  </div>
  <div class="article-meta">
    <a href="/uncategorized/make-a-list-view-in-angular/" class="post-date">
  <time datetime="2017-04-11T06:35:43.000Z">4月 11 2017</time>
</a>
    
<a href="http://nya.io/uncategorized/make-a-list-view-in-angular/#disqus_thread" class="comment-count">
  Comments
</a>

    
  <ul class="tag-list">
    
      <li>
        <a href="/tags/Angular/">#Angular</a>
      </li>
    
      <li>
        <a href="/tags/InfiniteList/">#InfiniteList</a>
      </li>
    
      <li>
        <a href="/tags/ListView/">#ListView</a>
      </li>
    
      <li>
        <a href="/tags/Performance/">#Performance</a>
      </li>
    
  </ul>

  </div>
</article>



  <article class="article-container">
  <a href="/uncategorized/Use-Angular-Http-Interceptors/" class="post-date mobile-meta">
  <time datetime="2015-05-08T08:20:11.000Z">5月 08 2015</time>
</a>
  <div class="article-content">
    <header class="article-header">
      
        

<h1>
  <a href="/uncategorized/Use-Angular-Http-Interceptors/">Use Angular $http Interceptors</a>
</h1>


      
    </header>
    <div class="article-entry">
      
        <p>When working with HTTP API of an backend, you need to handle various response from those APIs and make your own reaction on either success or failure response.
But those APIs are not always designed RESTfully, It may not indicate an error status using the status code of HTTP. Instead, it may use an special field in the
response body to indicate a status of an response. This implicate an burden on the developer who will not be able to use the facility provided by the
framework like <code>$http</code>. Normally, <code>$http()</code> would return an promise object which can be chained with <code>then</code> method to handle both success or failure response.
But when an HTTP request doesn’t using HTTP status code to indicate its result, your error handlers will never be called.
In this case, you may need to check the response entity carefully to see whether its special field indicates its failure status.</p>
<p>I’v also encountered this issue when joining a new team. And I think I can’t change the API definition. So the only way to save time is do some tricky.
And this issue can be easily solved by using $http interceptors.</p>
<p>Assume that I have an API which return an object like this.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="number">0</span>, <span class="comment">// 0 indicates an successful request, otherwise the request is a failure one.</span></span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">    &#125;,           <span class="comment">// this is what the real data resides in.</span></span><br><span class="line">    <span class="string">"message"</span>: <span class="literal">null</span> <span class="comment">// If status isn't 0, this message will contain the error information.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Well, this API definition is very straightforward though it is not follow the RESTful style. What I need do is to intercept every response made from this API
and check the value of <code>status</code>. If it is not 0, change the statusCode of the response object to &gt;=400. Besides, that I also want to make an global interceptor
to achieve this so I can get rid of writing same check code everywhere.</p>
<p>Let’s start to see what $http interceptors can help.</p>
<p>According to <a href="https://docs.angularjs.org/api/ng/service/$http#interceptors" target="_blank" rel="external">AngularJS Document</a> Interceptors are factory which can modify request and response.
You need define some interceptors and push them into <code>$httpProvider.interceptors</code> array in your <code>config</code> function.</p>
<p>Let’s define an interceptor to check the status and reject the response if status code is not 0.
Assume we have an API pattern is <code>/api/:someTarget</code> (:someTarget is an parameter which can be changed by need).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> restInterceptor = angular.module(<span class="string">'RestInterceptor'</span>, []);</span><br><span class="line"></span><br><span class="line">restInterceptor.factory(<span class="string">'RestInterceptor'</span>, <span class="function"><span class="keyword">function</span><span class="params">($q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// response function will be invoked when request responds with successful status.</span></span><br><span class="line">        <span class="comment">// This is usually means the status code is 200~299 or an redirect response</span></span><br><span class="line">        response: <span class="function"><span class="keyword">function</span><span class="params">(response)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> apiPattern = <span class="regexp">/^(?:\/api\/)\S+/</span>;</span><br><span class="line">            <span class="comment">// we need filter the config object to ensure only check our API response.</span></span><br><span class="line">            <span class="keyword">if</span>(apiPattern.test(response.config.url) &amp;&amp; <span class="keyword">typeof</span> response.data.status !== <span class="string">'undefined'</span> &amp;&amp; response.data.status !== <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//here we modify the http status code to 400 indicates this should be treated as an error.</span></span><br><span class="line">                response.status = <span class="number">400</span>;</span><br><span class="line">                <span class="comment">// reject this response will let the end point caller's error handler be called. also, you can</span></span><br><span class="line">                <span class="comment">// chain an responseError interceptor to handle this error.</span></span><br><span class="line">                <span class="keyword">return</span> $q.reject(response);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This code snippet create an interceptor to check the normal response whose HTTP status code is usually 200, but modify an response if its data.status doesn’t
equal 0. and modify the HTTP status code to 400. so we can treat the API as an RESTful API and All the facility provided by angular or three party dependency
can be used directly without redundant check code.</p>
<p>The rest job is to make the interceptor work, we need to push this factory into <code>$httpProvider.interceptors</code>. <strong>Note that the invoke order of <code>response</code> and <code>responseError</code>
interceptors are in reverse registration order. This is not clearly documented in official document.</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, [<span class="string">'RestInterceptor'</span>]);</span><br><span class="line">app.config(<span class="function"><span class="keyword">function</span><span class="params">($httpProvider, RestInterceptor)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// if you have other interceptors to handle error response, make sure to push "RestInterceptor" at last.</span></span><br><span class="line">    $httpProvider.interceptors.push(<span class="string">'OtherErrorHandlerInterceptor'</span>);</span><br><span class="line">    $httpProvider.interceptors.push(<span class="string">'RestInterceptor'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Now you can write your code without need to check whether you got an error in your success handler.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>);</span><br><span class="line">app.controller(<span class="string">'SomeController'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $http)</span></span>&#123;</span><br><span class="line">    $http.get(<span class="string">'/api/first-item'</span>)</span><br><span class="line">        .success(<span class="function"><span class="keyword">function</span><span class="params">(data, status, headers, config)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// write your code for successful request</span></span><br><span class="line">            <span class="comment">// result object will be always valid.</span></span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .error(<span class="function"><span class="keyword">function</span><span class="params">(data, status, headers, config)</span> </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(status); <span class="comment">// will print 400 when data.data.status != 0</span></span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Next time, I will use interceptor to write a notification module which will automatically make a toast notification to user when an API request
has failed. And will combine with the RestInterceptor I just have wrote.</p>

      
    </div>
  </div>
  <div class="article-additional">
    <div class="social-buttons">
      <a data-url="http://nya.io/uncategorized/Use-Angular-Http-Interceptors/" data-id="cj1vz8851001ceolsfrltqif8" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
      </a>
    </div>
    
<a href="http://nya.io/uncategorized/Use-Angular-Http-Interceptors/#disqus_thread" class="comment-count mobile-meta">
  Comments
</a>

    
  <ul class="tag-list nav-menu mobile-meta">
    
      <li>
        <a href="/tags/AngularJS/">#AngularJS</a>
      </li>
    
  </ul>

  </div>
  <div class="article-meta">
    <a href="/uncategorized/Use-Angular-Http-Interceptors/" class="post-date">
  <time datetime="2015-05-08T08:20:11.000Z">5月 08 2015</time>
</a>
    
<a href="http://nya.io/uncategorized/Use-Angular-Http-Interceptors/#disqus_thread" class="comment-count">
  Comments
</a>

    
  <ul class="tag-list">
    
      <li>
        <a href="/tags/AngularJS/">#AngularJS</a>
      </li>
    
  </ul>

  </div>
</article>



  <article class="article-container">
  <a href="/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/" class="post-date mobile-meta">
  <time datetime="2015-04-20T04:05:49.000Z">4月 20 2015</time>
</a>
  <div class="article-content">
    <header class="article-header">
      
        

<h1>
  <a href="/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/">Beware Of Using value Attribute On list element</a>
</h1>


      
    </header>
    <div class="article-entry">
      
        <p>In AngularJs development, we use custom attribute in our directive is nontrivial things. you can even use some attributes which may already be defined
in W3C standards of that element. well, this doesn’t matter at most circumstance. But it is not recommended to override the meaning of those attribute
 originally defined by W3C. I have paid for this.</p>
<p>I have a directive <a href="http://nya.io/nya-bootstrap-select/" target="_blank" rel="external">nya-bootstrap-select</a> which using a <code>value</code> attribute on list element. I give this attribute
a new meaning that its value will be the option value for predefined options. It works well in AngularJS apps until I tried to add some e2e test on
it using <a href="http://angular.github.io/protractor/" target="_blank" rel="external">Protractor</a>.</p>
<p>In Protractor elements are selected by the webdriver api and I hasn’t look into the implementation of selenium, but I can sure it may take the W3C standard
and make its own implementation to retrieve the value of <code>value</code> attribute.</p>
<p>As the W3C standards says:</p>
<blockquote>
<p>This integer attributes indicates the current ordinal value of the item in the list as defined by the <code>&lt;ol&gt;</code> element. The only allowed value for this attribute is a number, even if the list is displayed with Roman numerals or letters. List items that follow this one continue numbering from the value set. The value attribute has no meaning for unordered lists (<code>&lt;ul&gt;</code>) or for menus (<code>&lt;menu&gt;</code>).</p>
</blockquote>
<p>The list element has a <code>value</code> attribute which <strong>only accepts integer value</strong>. Although I can use a String value in my AngularJS app but this is not warranted
by standard and can varies between implementations. Just as the selenium implementation, the WebElement.getAttribute(‘value’) on my directive always
return <code>0</code>. This is not my expected.</p>
<p>In conclusion, It is recommended for those who want to use some predefined attribute on their own directive to look up the standard whether its behavior has already been defined to
avoid conflicts and variants between implementations.</p>

      
    </div>
  </div>
  <div class="article-additional">
    <div class="social-buttons">
      <a data-url="http://nya.io/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/" data-id="cj1vz885b001reolscknv2pde" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
      </a>
    </div>
    
<a href="http://nya.io/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/#disqus_thread" class="comment-count mobile-meta">
  Comments
</a>

    
  <ul class="tag-list nav-menu mobile-meta">
    
      <li>
        <a href="/tags/AngularJs/">#AngularJs</a>
      </li>
    
      <li>
        <a href="/tags/HTML/">#HTML</a>
      </li>
    
  </ul>

  </div>
  <div class="article-meta">
    <a href="/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/" class="post-date">
  <time datetime="2015-04-20T04:05:49.000Z">4月 20 2015</time>
</a>
    
<a href="http://nya.io/AngularJS/Beware-Of-Using-value-Attribute-On-list-element/#disqus_thread" class="comment-count">
  Comments
</a>

    
  <ul class="tag-list">
    
      <li>
        <a href="/tags/AngularJs/">#AngularJs</a>
      </li>
    
      <li>
        <a href="/tags/HTML/">#HTML</a>
      </li>
    
  </ul>

  </div>
</article>



  <article class="article-container">
  <a href="/uncategorized/Busting-The-Cache/" class="post-date mobile-meta">
  <time datetime="2015-04-05T02:58:36.000Z">4月 05 2015</time>
</a>
  <div class="article-content">
    <header class="article-header">
      
        

<h1>
  <a href="/uncategorized/Busting-The-Cache/">Busting The Cache</a>
</h1>


      
    </header>
    <div class="article-entry">
      
        <p>Last week, I completed my new hexo theme, but newly added page were broken because the stylesheet were not updated with the page. This was caused by the cache either on browser side or on the CDN of github pages side.
So I decided to solve this issue by using a method to busting the cache whenever I have updated the assets files.</p>
<p>If anyone have ever used yeoman to generate an angular project. You may find a grunt task in the generated <em>Gruntfile</em> called <a href="https://github.com/yeoman/grunt-usemin" target="_blank" rel="external">usemin</a>.
This task combined with several other task can concatenate your stylesheet and
javascript files then minimize those files, at last a file revision task is executed internally. The key of busting cache is the file revision task which will calculate your files’ hash value and use the value to
rename your file, this will totally solve the cache issue. whenever your file changes, the hash value changes and you get a different filename of assets.</p>
<p>Back to the hexo theme project, I found it is hard to use the grunt task directly in my project because those task will modify the html or template file to update the <code>script</code> and <code>link</code> tag in order to
revision the assets file name. But hexo template file should only be modifed by programmer and generate html file by hexo. So I think it’s time to write a similar procedure by myself using hexo api.</p>
<p>Hexo provide two api <a href="http://hexo.io/api/helper.html" target="_blank" rel="external">helper</a> and <a href="http://hexo.io/api/generator.html" target="_blank" rel="external">generator</a> to generate tags in template and generate files with specified path. I will use this two api to keep the reference in template update and generate the new file with hash prefix file name.
Because I can’t ensure the execution order of these two api, the concat and minified operation are abandoned.
First let’s write a file hash method. This method accepts two arguments: file absolute path and hash digit length. because we don’t need the entire hash string to name asset file. the return value will be the new file name prefixed with a hash string</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">  path = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">  crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="comment">// modules above will be shared in the following two code blocks.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filehash</span><span class="params">(filepath, digitlength)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = crypto.createHash(<span class="string">'md5'</span>).update(fs.readFileSync(filepath)).digest(<span class="string">'hex'</span>);</span><br><span class="line">  <span class="keyword">var</span> prefix = hash.slice(<span class="number">0</span>, digitlength);</span><br><span class="line">  <span class="keyword">return</span> prefix + <span class="string">'.'</span> + path.basename(filepath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method will be called by <code>helper</code> and <code>generator</code> to get the assets files’ hash value file name.</p>
<p>Now let’s begin from the <code>generator</code>. this api will let me to provide an array which tell hexo to write some files with specified path. I can copy the assets file with hashed file name.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> themeSourcePath = path.resolve(__dirname, <span class="string">'../source'</span>); <span class="comment">// we need the theme source path to find the assets folder</span></span><br><span class="line"><span class="keyword">var</span> hashLength = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// this is define of the generator.</span></span><br><span class="line">hexo.extend.generator.register(<span class="string">'filerev'</span>, <span class="function"><span class="keyword">function</span><span class="params">(locals)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// find all directories in theme source directory.</span></span><br><span class="line">  <span class="keyword">var</span> directories = fs.readdirSync(themeSourcePath);</span><br><span class="line">  <span class="keyword">var</span> outputData = [];</span><br><span class="line">  directories.filter(<span class="function"><span class="keyword">function</span><span class="params">(dir)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dir === <span class="string">'css'</span> || dir === <span class="string">'js'</span>;</span><br><span class="line">  &#125;).forEach(<span class="function"><span class="keyword">function</span><span class="params">(dir)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> files = fs.readdirSync(path.join(themeSourcePath, dir));</span><br><span class="line">    outputData = outputData.concat(files.map(<span class="function"><span class="keyword">function</span><span class="params">(file)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        path: dir + <span class="string">'/'</span> + filehash(path.join(themeSourcePath, dir, file), hashLength),  <span class="comment">// call filehash method we write before.</span></span><br><span class="line">        data: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fs.createReadStream(path.join(themeSourcePath, dir, file));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> outputData;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This generator will generate a set of new file with the hash prefix and its original folder structure in <code>public</code> folder when you run <code>hexo generate</code>.</p>
<p>With the hash prefixed file generated properly, we have to update the reference in <code>script</code> and <code>link</code> tag. here we using <code>helper</code> to define an <em>ejs</em> helper called <code>usemin</code> to generate our <code>script</code> and <code>link</code> tag.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.helper.register(<span class="string">'usemin'</span>, <span class="function"><span class="keyword">function</span><span class="params">(input)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> filepath = path.join(themeSourcePath, input);</span><br><span class="line">  <span class="keyword">var</span> dir = input.split(<span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">var</span> ext = path.extname(input);</span><br><span class="line">  <span class="keyword">var</span> newFilename = filehash(filepath, hashLength);</span><br><span class="line">  <span class="keyword">var</span> newPath = path.resolve(<span class="string">'/'</span>, path.join(dir.slice(<span class="number">0</span>, dir.length - <span class="number">1</span>).join(<span class="string">'/'</span>), newFilename));</span><br><span class="line">  <span class="keyword">return</span> ext === <span class="string">'.js'</span> ? <span class="string">'&lt;script type="text/javascript" src="'</span> + newPath + <span class="string">'"&gt;&lt;/script&gt;'</span> : <span class="string">'&lt;link rel="stylesheet" href="'</span> + newPath + <span class="string">'"&gt;'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Put this scripts file in scripts folder under my theme directory, the script will be loaded by hexo automatically. Now there are only one step to get the goal, modify template using the <code>usemin</code> helper</p>
<p>In head.ejs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- other tags... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">%-</span> <span class="attribute">usemin</span>('<span class="attribute">css</span>/<span class="attribute">styles.css</span>') %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">%-</span> <span class="attribute">css</span>('<span class="attribute">fancybox</span>/<span class="attribute">source</span>/<span class="attribute">jquery.fancybox.css</span>') %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>In scripts.ejs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- other tags... --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">%-</span> <span class="attribute">usemin</span>('<span class="attribute">js</span>/<span class="attribute">jquery.js</span>') %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">%-</span> <span class="attribute">js</span>('<span class="attribute">fancybox</span>/<span class="attribute">source</span>/<span class="attribute">jquery.fancybox.js</span>') %&gt;</span> <span class="comment">&lt;!-- we can't process this file, so use the js helper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">%-</span> <span class="attribute">usemin</span>('<span class="attribute">js</span>/<span class="attribute">caption.js</span>') %&gt;</span></span><br></pre></td></tr></table></figure>
<p>When I run <code>hexo generate</code>, the index.html will be generated by hexo which contains head.ejs and scripts.ejs part</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- omit other tags... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"/css/2bb849c6.styles.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"/fancybox/source/jquery.fancybox.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- omit other tags... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"/js/cf26f8f0.jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/fancybox/source/jquery.fancybox.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"/js/33415e49.caption.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>
  </div>
  <div class="article-additional">
    <div class="social-buttons">
      <a data-url="http://nya.io/uncategorized/Busting-The-Cache/" data-id="cj1vz8859001qeols92f60iml" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
      </a>
    </div>
    
<a href="http://nya.io/uncategorized/Busting-The-Cache/#disqus_thread" class="comment-count mobile-meta">
  Comments
</a>

    
  </div>
  <div class="article-meta">
    <a href="/uncategorized/Busting-The-Cache/" class="post-date">
  <time datetime="2015-04-05T02:58:36.000Z">4月 05 2015</time>
</a>
    
<a href="http://nya.io/uncategorized/Busting-The-Cache/#disqus_thread" class="comment-count">
  Comments
</a>

    
  </div>
</article>



</section>

<section class="pagination-holder">


  <a class="pager pull-right" href="/page/2/">
    OLDER POSTS
    <i class="fa fa-chevron-right"></i>
  </a>

</section>

</div>

<footer class="footer">
  <div class="container">
    <div class="footer-inner">

      <section class="copyright">
        Nyasoft © 2015
      </section>

      <section class="designedby">
        Theme
        <a href="#">Timeline</a>
        Designed By
        Nyasoft
      </section>

      <section class="poweredby">
        Powered By
        <a href="http://hexo.io/">Hexo</a>
      </section>
    </div>
  </div>
</footer>


<script>
  var disqus_shortname = 'lordfriend';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script type="text/javascript" src="/js/cf26f8f0.jquery.js"></script>
<script src="/fancybox/source/jquery.fancybox.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/33415e49.caption.js"></script>
</body>